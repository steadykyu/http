# 1. 인터넷 통신

결국 Web이나 http가 네트워크를 기준으로 작동하기 때문에 어느정도 이해는 하고 있어야한다.

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_1.png" width="70%" height="70%">
</p>

그림 속의 인터넷 안은 어떤 규칙으로 이루어져있는지 아래 내용들을 통해 이해해 보자.

# 2. IP

> IP 주소부여

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_2.png" width="70%" height="70%">
</p>

Hello world란 메세지를 보낸다고 가정하자. IP 프로토콜에 알맞은 IP주소로 메세지를 보내는 것이다.

## 2.1 역할

인터넷 프로토콜 역할

- 지정한 IP 주소(IP Address)에 데이터 전달

- 패킷(Packet)이라는 통신 단위로 데이터 전달

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_3.png" width="70%" height="70%">
</p>

패킷은 출발지 IP, 목적지IP, 전송데이터를 가지고 있는 소포임에 유의해서 보자.

요청 할때와 응답 할때 인터넷 망이 복잡하기 때문에 서로 다른 노드로 전달 될 수 있다.

## 2.2 IP 프로토콜의 한계

> 비연결성

패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_4.png" width="70%" height="70%">
</p>

> 비신뢰성

- 중간에 패킷이 사라지면?

- 패킷이 순서대로 안오면?

패킷 용량이 매우 클때 우리가 나눠서 보내는 경우가 있다. 그런데 그림 과 같이 각각 다른 노드들을 타다가 잘못된 순서로 갈 수가 있다.

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_5.png" width="70%" height="70%">
</p>

> 프로그램 구분

같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 둘 이상이면?

예) 노래를 들으면서, 게임과 유튜브를 한다고 하면 전부가 같은 IP이다.

이럴때는 IP 프로토콜 만으로는 구분할 수 없다.

---

IP 프로토콜 만으로는 이 문제들을 해결할 수 없다. 그러므로 TCP가 등장한다.

# 3. TCP, UDP

## 3.1 프로토콜 4계층

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_6.png" width="70%" height="70%">
</p>

(우리의 메세지)HTTP 정보를 TCP 정보로 감싸고 IP 패킷으로 생성한 후, Ethenet frame으로 감싼 후에 서버로 보낸다.

## 3.2 TCP/IP 패킷 정보

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_7.png" width="70%" height="70%">
</p>

전송제어 ,순서 ,검증정보, 출발 port, 목적지 port 등이 TCP에 들어있기 떄문에 아래의 특징을 지닐 수 있게 된다.

또한 가장 신뢰성 높은 정보로 TCP가 인정 받게 된다.

## 3.3 TCP 특징

전송 제어 프로토콜(Transmission Control Protocol)

- 연결 지향 - TCP 3 way handshake (가상 연결)

연결이 되어있지를 확인하고 연결한 후에 메세지를 보낸다.

- 데이터 전달 보증

메세지(http)를 보낸 내가 누락을 알수 있다.

- 순서 보장

* 신뢰할 수 있는 프로토콜
* 현재는 대부분 TCP 사용

---

추가적기능이 있으나 웹에서는 이대로도 충분하다.

### 3.3.1 TCP 3 way handshake

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_8.png" width="70%" height="70%">
</p>

- SYN : synchronoize 를 의미

- 그림을 보면 연결 확인을 위해 3가지 과정을 거쳐가는 것을 알 수 있다.

- 요즘에는 ACK를 보낼때 동시에 데이터를 전송한다.

- 이 과정은 가상 연결로 개념적으로 연결이 된것이다.

여기서의 연결은 이전 전화선에서는 전화선을 port에 물리적으로 꽂아주는 작업과는 다르다.

클라와 서버가 수많은 서버들을 거쳐 서로 논리적으로 연결이 되었다 라고 인식하는 개념이다.

### 3.3.2 전달 보증

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_9.png" width="70%" height="70%">
</p>

### 3.3.3 순서 보장

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_10.png" width="70%" height="70%">
</p>

## 3.4 UDP 프로토콜

사용자 데이터그램 프로토콜(User Datagram Protocol)

- PORT 기능이 있는 하얀 도화지에 비유(기능이 거의 없음)
- 연결지향 - TCP 3 way handshake X
- 데이터 전달 보증 X
- 순서 보장 X
- 데이터 전달 및 순서가 보장되지 않지만, **단순하고 빠름**

* 정리
  - IP와 거의 같다. +PORT +체크섬 정도만 추가
  - 애플리케이션에서 추가 작업 필요

> port

하나의 IP에서 여러가지 App를 사용하는 경우(노래,유튜브,게임 동시에하는 경우) IP에 다양한 패킷이 전송 될 것 이다. 이를 구분해주는 역할로 port가 사용된다.
(4. port 참고)

> 체크섬

체크섬 : 메세지에 대해서 맞는지 검증해주는 데이터이다.

> 최근의 UDP

TCP는 신뢰할수 있고 여러 장점들이 있지만, 데이터 전송속도가 빠를 수가 없다. 이미 TCP는 인터넷 프로토콜로 안정화되어 넷상에 잘 만들어져 있다.

최근에 UDP가 그래서 각광을 받고 있다. TCP가 데이터 전송의 90%를 점유하고 있기때문에 이제 http3부터 UDP를 활용해서 전송속도를 최적화 하려는 움직임이 있다.

# 4. PORT(항구)

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_11.png" width="70%" height="70%">
</p>

앞으로는 TCP/IP 패킷으로 묶어서 표현한다.

목적지 IP는 서버의 목적지를 찾는 것이고, 목적지 PORT는 서버안에서 돌아가는 APP들을 구분한 것을 Port라고 보면 된다.

> PORT - 같은 IP 내에서 프로세스 구분

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_12.png" width="70%" height="70%">
</p>

ex) 8090 에서 출발하면 100.100.100.1 IP주소와 8090 출발지 Port 그리고 200.200.200.2 IP주소와 11220 목적지 Port가 담긴 패킷을 서버에 보낸다.

> 비유

실세계의 아파트가 IP 주소라면 Port는 몇동 몇호 의 느낌이다.

> 특징

- 0 ~ 65535 할당 가능
- 0 ~ 1023: 잘 알려진 포트, 사용하지 않는 것이 좋음
  - FTP - 20, 21
  - TELNET - 23
  - HTTP - 80
  - HTTPS - 443 (보안)

# 5. DNS

> 탄생 이유

1. IP는 기억하기 어렵다.

2. IP는 변경 될수 있다.

이렇게 되면 클라이언트가 접근을 할 수 없게 된다.

## 5.1 DNS 특징

도메인 네임 시스템(Domain Name System)

- 전화번호부 기능

- 도메인 명을 IP 주소로 변환

<p align="center">
<img src ="https://github.com/steadykyu/http/blob/master/img/http1_13.png" width="70%" height="70%">
</p>

- 클라이언트가 도메인 명을 입력하면 DNS 서버에서 이에 해당하는 IP를 준다.

- DNS 서버를 사용하면 위의 1번, 2번의 문제를 해결 할수 있다.

- 만약 IP가 바뀌면, 서버측에서 DNS 서버에 있는 IP만 수정하면 된다. 이러면 클라이언트에게는 아무런 영향이 없다.

> 참고

DNS 서버에 도메인을 만드는 것은 비용이 든다.
